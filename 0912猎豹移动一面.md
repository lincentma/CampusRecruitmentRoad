# 猎豹移动一面

## Python项目

- 详细介绍项目流程

## Java项目

- 详细介绍后台管理系统的设计流程

## MySQL数据库开放性问题

1. 谈谈你对于MySQL设计的理解

> 自己主要根据项目经历和实习经历中使用MySQL的经验，从数据库表建立和索引建立这两方面来回答。

> 在网上找到了数据库的发展历史。

> ![](http://images2015.cnblogs.com/blog/63651/201703/63651-20170308091123641-636480917.jpg)

> MySQL是一种关系数据库管理系统，关系数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。
MySQL所使用的 SQL 语言是用于访问数据库的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。

> 数据库设计原则

> 1. 基本表及其字段之间的关系, 应尽量满足第三范式。但是，满足第三范式的数据库设计，往往不是最好的设计。为了提高数据库的运行效率，常常需要降低范式标准：适当增加冗余，达到以空间换时间的目的。
> 2. 数据库范式 
> - 第一范式：1NF是对属性的原子性约束，要求属性具有原子性，不可再分解

> - 第二范式：2NF是对记录的惟一性约束，要求记录有惟一标识，即实体的惟一性； 

> - 第三范式：3NF是对字段冗余性的约束，即任何字段不能由其他字段派生出来，它要求字段没有冗余。 

> 3. 冗余的目的是为了提高处理速度。只有低级冗余才会增加数据的不一致性，因为同一数据，可 能从不同时间、地点、角色上多次录入。因此，我们提倡高级冗余(派生性冗余)，反对低级冗余(重复性冗余)。 

> 4. 视图是一种虚表，它依赖数据源的实表而存在。视图是供程序员使用数据库的一个窗口，是基表数据综合的一种形式, 是数据处理的一种方法，是用户数据保密的一种手段。为了进行复杂处理、提高运算速度和节省存储空间, 视图的定义深度一般不得超过三层。 若三层视图仍不够用, 则应在视图上定义临时表, 在临时表上再定义视图。这样反复交迭定义, 视图的深度就不受限制了。 

> 5. 中间表是存放统计数据的表，它是为数据仓库、输出报表或查询结果而设计的，有时它没有主键与外键(数据仓库除外)。临时表是程序员个人设计的，存放临时记录，为个人所用。基表和中间表由DBA维护，临时表由程序员自己用程序自动维护。 

> 数据库设计的实用原则是：在数据冗余和处理速度之间找到合适的平衡点。

> 提高数据库运行效率的办法。在给定的系统硬件和系统软件条件下，提高数据库系统的运行效率的办法是： 
> 1. 在数据库物理设计时，降低范式，增加冗余, 少用触发器, 多用存储过程。 
> 2. 当计算非常复杂、而且记录条数非常巨大时(例如一千万条)，复杂计算要先在数据库外面，以文件系统方式用C++语言计算处理完成之后，最后才入库追加到表中去。这是电信计费系统设计的经验。 
> 3. 发现某个表的记录太多，例如超过一千万条，则要对该表进行水平分割。水平分割的做法是，以该表主键PK的某个值为界线，将该表的记录水平分割为两个表。若发现某个表的字段太多，例如超过八十个，则垂直分割该表，将原来的一个表分解为两个表。 
> 4. 对数据库管理系统DBMS进行系统优化，即优化各种系统参数，如缓冲区个数。 
> 5. 在使用面向数据的SQL语言进行程序设计时，尽量采取优化算法。

- 参考文章：[总结数据库设计的原则](http://www.php.cn/mysql-tutorials-362535.html)


2. MySQL如何面对高并发用户的访问

> 自己的回答主要是从主从分离以及Redis结果缓存这两方面回答。

> 1. 查询SQL优化

> 2. 分库分表

> 分表：例如user表按照user_id%256的策略进行分表。分表能够解决单表数据量过大带来的查询效率下降的问题，但是，却无法给数据库的并发处理能力带来质的提升。面对高并发的读写访问，当数据库Master服务器无法承载写操作压力 时，不管如何扩展Slave服务器，此时都没有意义了。

> 分库: 对数据库进行拆分，从而提高数据库写入能力，这就是所谓的分库。假设user_id字段的值为257,将原有的单库分为256个库，那么应用程序对数据库的访问请求将被路由到第1个库（257%256=1)。

> ![](http://www.itmmd.com/html/kindeditor/pic/20141123/2014112313161872719980.jpg)

> 有时数据库可能既面临着高并发访问的压力，又需要面对海量数据的存储问题，这时需要对数据库即采用分库策略，又采用分表策略，以便同时扩展系统的并发处理能力，以及提升单 表的查询性能，这就是所谓的分库分表。
- 中间变量=user_id% (库数量X每个库的表数量）
- 库=取整（中间变量/每个库的表数量）
- 表=中间变量％每个库的表数量。

> 假设将原来的单库单表order拆分成256个库，每个库包含1024个表，那么按照前面所提到的路由策略，对于user_id=262145的访问，路由的计算过程如下：中间变量=262145% (256X1024) =1;库=取整（1/1024) =0;表=1%1024=1。
这意味着，对于user_id=262145的订单记录的查询和修改，将被路由到第0个库的第1个表中执行。

- 参考文章：[大型网站架构设计-mysql分表与分库](http://www.itmmd.com/201411/208.html)

> 使用队列：使用队列写入等方法来降低并发读写:Redis队列


> 3. 缓存设计

> 采用redis数据库，前置到mysql。

> 例如秒杀场景：必须使用缓存，将需要秒杀的商品放入缓存中，并使用锁来处理其并发情况。当接到用户秒杀提交订单的情况下，先将商品数量递减（加锁/解锁）后再进行其他方面的处理，处理失败在将数据递增1（加锁/解锁），否则表示交易成功。当商品数量递减到0时，表示商品秒杀完毕，拒绝其他用户的请求。

> 多用户并发修改同一条记录。

> 乐观锁，就是在数据库设计一个版本号的字段，每次修改都使其+1，这样在提交时比对提交前的版本号就知道是不是并发提交了，但是有个缺点就是只能是应用中控制，如果有跨应用修改同一条数据乐观锁就没办法了，这个时候可以考虑悲观锁。

> 悲观锁，就是直接在数据库层面将数据锁死，类似于oralce中使用select xxxxx from xxxx where xx=xx for update，这样其他线程将无法提交数据。

> 除了加锁的方式也可以使用接收锁定的方式，思路是在数据库中设计一个状态标识位，用户在对数据进行修改前，将状态标识位标识为正在编辑的状态，这样其他用户要编辑此条记录时系统将发现有其他用户正在编辑，则拒绝其编辑的请求，类似于你在操作系统中某文件正在执行，然后你要修改该文件时，系统会提醒你该文件不可编辑或删除。

- 参考文章：[mysql处理高并发，防止库存超卖](https://segmentfault.com/a/1190000007703843)

